var B=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var Ne=B(()=>{var He=function(){function r(d,u){Object.defineProperty(this,"name",{enumerable:!1,writable:!1,value:"JisonParserError"}),d==null&&(d="???"),Object.defineProperty(this,"message",{enumerable:!1,writable:!0,value:d}),this.hash=u;var h;if(u&&u.exception instanceof Error){var t=u.exception;this.message=t.message||d,h=t.stack}h||(Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,this.constructor):h=new Error(d).stack),h&&Object.defineProperty(this,"stack",{enumerable:!1,writable:!1,value:h})}typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(r.prototype,Error.prototype):r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r.prototype.name="JisonParserError";function e(d){for(var u=[],h=d.pop,t=d.rule,s=0,g=h.length;s<g;s++)u.push([h[s],t[s]]);return u}function o(d){for(var u={},h=d.idx,t=d.goto,s=0,g=h.length;s<g;s++){var a=h[s];u[a]=t[s]}return u}function c(d){for(var u=[],h=d.len,t=d.symbol,s=d.type,g=d.state,a=d.mode,l=d.goto,x=0,G=h.length;x<G;x++){for(var w=h[x],W={},Z=0;Z<w;Z++){var Y=t.shift();switch(s.shift()){case 2:W[Y]=[a.shift(),l.shift()];break;case 0:W[Y]=g.shift();break;default:W[Y]=[3]}}u.push(W)}return u}function n(d,u,h){h=h||0;for(var t=0;t<u;t++)this.push(d),d+=h}function i(d,u){for(d=this.length-d,u+=d;d<u;d++)this.push(this[d])}function m(d){for(var u=[],h=0,t=d.length;h<t;h++){var s=d[h];typeof s=="function"?(h++,s.apply(u,d[h])):u.push(s)}return u}var J={trace:function(){},JisonParserError:r,yy:{},options:{type:"slr",errorRecoveryTokenDiscardCount:3},symbols_:{$accept:0,$end:1,"%prec":32,Add:36,AddAssign:22,And:41,BeginCommand:4,Comma:49,CommandCall:14,Dedent:13,Divide:39,DivideAssign:25,EOF:1,Else:8,ElseIf:9,EndCommand:6,EndIf:7,EndOfInput:3,EqualTo:43,EqualToOrAssign:21,False:27,GreaterThan:45,GreaterThanOrEqualTo:46,Identifier:18,If:5,Indent:12,LeftParen:34,LessThan:47,LessThanOrEqualTo:48,Minus:37,MinusAssign:23,Multiply:38,MultiplyAssign:24,Not:33,NotEqualTo:44,Null:30,Number:28,OptionDelimit:17,OptionEnd:16,OptionStart:15,Or:40,RightParen:35,Set:19,ShortcutOption:11,String:29,Text:10,True:26,UnaryMinus:31,Variable:20,Xor:42,additionalConditionalStatements:53,argument:63,arguments:62,assignment:59,command:56,conditionalStatement:52,error:2,expression:60,functionResultExpression:61,jump:57,link:58,node:50,shortcut:55,statement:54,statements:51},terminals_:{1:"EOF",2:"error",3:"EndOfInput",4:"BeginCommand",5:"If",6:"EndCommand",7:"EndIf",8:"Else",9:"ElseIf",10:"Text",11:"ShortcutOption",12:"Indent",13:"Dedent",14:"CommandCall",15:"OptionStart",16:"OptionEnd",17:"OptionDelimit",18:"Identifier",19:"Set",20:"Variable",21:"EqualToOrAssign",22:"AddAssign",23:"MinusAssign",24:"MultiplyAssign",25:"DivideAssign",26:"True",27:"False",28:"Number",29:"String",30:"Null",31:"UnaryMinus",32:"%prec",33:"Not",34:"LeftParen",35:"RightParen",36:"Add",37:"Minus",38:"Multiply",39:"Divide",40:"Or",41:"And",42:"Xor",43:"EqualTo",44:"NotEqualTo",45:"GreaterThan",46:"GreaterThanOrEqualTo",47:"LessThan",48:"LessThanOrEqualTo",49:"Comma"},TERROR:2,EOF:1,originalQuoteName:null,originalParseError:null,cleanupAfterParse:null,constructParseErrorInfo:null,yyMergeLocationInfo:null,__reentrant_call_depth:0,__error_infos:[],__error_recovery_infos:[],quoteName:function(u){return'"'+u+'"'},getSymbolName:function(u){if(this.terminals_[u])return this.terminals_[u];var h=this.symbols_;for(var t in h)if(h[t]===u)return t;return null},describeSymbol:function(u){if(u!==this.EOF&&this.terminal_descriptions_&&this.terminal_descriptions_[u])return this.terminal_descriptions_[u];if(u===this.EOF)return"end of input";var h=this.getSymbolName(u);return h?this.quoteName(h):null},collect_expected_token_set:function(u,h){var t=this.TERROR,s=[],g={};if(!h&&this.state_descriptions_&&this.state_descriptions_[u])return[this.state_descriptions_[u]];for(var a in this.table[u])if(a=+a,a!==t){var l=h?a:this.describeSymbol(a);l&&!g[l]&&(s.push(l),g[l]=!0)}return s},productions_:e({pop:m([50,n,[51,4],52,52,n,[53,3],n,[54,6],55,n,[55,5,1],n,[59,4],n,[60,24],61,62,62,n,[63,3]]),rule:m([n,[2,3],1,1,8,6,7,8,6,n,[1,6],5,9,3,3,5,n,[6,5],n,[1,6],4,4,2,n,[3,14],1,4,3,n,[1,4]])}),performAction:function(u,h,t,s,g){var a=this.yy,l=a.parser,x=a.lexer;switch(h){case 0:this.$=s[t-1],this._$=g[t-1];break;case 1:return this.$=s[t-1],this._$=l.yyMergeLocationInfo(t-1,t),JSON.stringify(s[t-1],null,"  "),s[t-1];break;case 2:case 3:this._$=l.yyMergeLocationInfo(t-1,t),this.$=s[t-1].concat([s[t]]);break;case 4:case 5:case 53:this._$=g[t],this.$=[s[t]];break;case 6:this._$=l.yyMergeLocationInfo(t-7,t),this.$=new a.IfNode(s[t-5],s[t-3]);break;case 7:this._$=l.yyMergeLocationInfo(t-5,t),this.$=new a.IfElseNode(s[t-3],s[t-1],s[t]);break;case 8:this._$=l.yyMergeLocationInfo(t-6,t),this.$=new a.ElseNode(s[t-3]);break;case 9:this._$=l.yyMergeLocationInfo(t-7,t),this.$=new a.ElseIfNode(s[t-5],s[t-3]);break;case 10:this._$=l.yyMergeLocationInfo(t-5,t),this.$=new a.ElseIfNode(s[t-3],s[t-1],s[t]);break;case 11:case 12:case 13:case 14:case 15:case 50:this._$=g[t],this.$=s[t];break;case 16:this._$=g[t],this.$=new a.TextNode(s[t],this._$);break;case 17:this._$=l.yyMergeLocationInfo(t-4,t),this.$=new a.DialogOptionNode(s[t-3],s[t-1],this._$);break;case 18:this._$=l.yyMergeLocationInfo(t-8,t),this.$=new a.ConditionalDialogOptionNode(s[t-7],s[t-1],s[t-4],this._$);break;case 19:this._$=l.yyMergeLocationInfo(t-2,t),this.$=new a.CommandNode(s[t-1],this._$);break;case 20:this._$=l.yyMergeLocationInfo(t-2,t),this.$=new a.JumpNode(s[t-1],this._$);break;case 21:this._$=l.yyMergeLocationInfo(t-4,t),this.$=new a.LinkNode(s[t-3],s[t-1],this._$);break;case 22:this._$=l.yyMergeLocationInfo(t-5,t),this.$=new a.SetVariableEqualToNode(s[t-3].substring(1),s[t-1]);break;case 23:this._$=l.yyMergeLocationInfo(t-5,t),this.$=new a.SetVariableAddNode(s[t-3].substring(1),s[t-1]);break;case 24:this._$=l.yyMergeLocationInfo(t-5,t),this.$=new a.SetVariableMinusNode(s[t-3].substring(1),s[t-1]);break;case 25:this._$=l.yyMergeLocationInfo(t-5,t),this.$=new a.SetVariableMultipyNode(s[t-3].substring(1),s[t-1]);break;case 26:this._$=l.yyMergeLocationInfo(t-5,t),this.$=new a.SetVariableDivideNode(s[t-3].substring(1),s[t-1]);break;case 27:case 28:this._$=g[t],this.$=new a.BooleanLiteralNode(s[t]);break;case 29:case 54:this._$=g[t],this.$=new a.NumericLiteralNode(s[t]);break;case 30:case 55:this._$=g[t],this.$=new a.StringLiteralNode(s[t]);break;case 31:this._$=g[t],this.$=new a.NullLiteralNode(s[t]);break;case 32:case 56:this._$=g[t],this.$=new a.VariableNode(s[t].substring(1));break;case 33:this._$=l.yyMergeLocationInfo(t-3,t),this.$=new a.UnaryMinusExpressionNode(s[t-2]);break;case 34:this._$=l.yyMergeLocationInfo(t-3,t),this.$=new a.UnaryMinusExpressionNode(s[t-2].substring(1));break;case 35:this._$=l.yyMergeLocationInfo(t-1,t),this.$=new a.NegatedBooleanExpressionNode(s[t]);break;case 36:this._$=l.yyMergeLocationInfo(t-2,t),this.$=new a.ArithmeticExpressionNode(s[t-1]);break;case 37:this._$=l.yyMergeLocationInfo(t-2,t),this.$=new a.ArithmeticExpressionAddNode(s[t-2],s[t]);break;case 38:this._$=l.yyMergeLocationInfo(t-2,t),this.$=new a.ArithmeticExpressionMinusNode(s[t-2],s[t]);break;case 39:this._$=l.yyMergeLocationInfo(t-2,t),this.$=new a.ArithmeticExpressionMultiplyNode(s[t-2],s[t]);break;case 40:this._$=l.yyMergeLocationInfo(t-2,t),this.$=new a.ArithmeticExpressionDivideNode(s[t-2],s[t]);break;case 41:this._$=l.yyMergeLocationInfo(t-2,t),this.$=new a.BooleanOrExpressionNode(s[t-2],s[t]);break;case 42:this._$=l.yyMergeLocationInfo(t-2,t),this.$=new a.BooleanAndExpressionNode(s[t-2],s[t]);break;case 43:this._$=l.yyMergeLocationInfo(t-2,t),this.$=new a.BooleanXorExpressionNode(s[t-2],s[t]);break;case 44:this._$=l.yyMergeLocationInfo(t-2,t),this.$=new a.EqualToExpressionNode(s[t-2],s[t]);break;case 45:this._$=l.yyMergeLocationInfo(t-2,t),this.$=new a.NotEqualToExpressionNode(s[t-2],s[t]);break;case 46:this._$=l.yyMergeLocationInfo(t-2,t),this.$=new a.GreaterThanExpressionNode(s[t-2],s[t]);break;case 47:this._$=l.yyMergeLocationInfo(t-2,t),this.$=new a.GreaterThanOrEqualToExpressionNode(s[t-2],s[t]);break;case 48:this._$=l.yyMergeLocationInfo(t-2,t),this.$=new a.LessThanExpressionNode(s[t-2],s[t]);break;case 49:this._$=l.yyMergeLocationInfo(t-2,t),this.$=new a.LessThanOrEqualToExpressionNode(s[t-2],s[t]);break;case 51:this._$=l.yyMergeLocationInfo(t-3,t),this.$=new a.FunctionResultNode(s[t-3],s[t-1]);break;case 52:this._$=l.yyMergeLocationInfo(t-2,t),this.$=s[t-2].concat([s[t]]);break}},table:c({len:m([12,1,12,0,0,3,n,[0,6],1,1,n,[0,3],12,1,1,2,2,14,n,[0,6],2,12,12,0,1,0,5,12,1,0,1,n,[12,14],i,[42,3],14,5,i,[12,8],12,15,15,0,0,n,[15,9],i,[27,3],2,n,[0,4],n,[14,5],0,14,0,6,n,[0,4],4,i,[96,7],i,[109,3],12,0,12,14,12,11,12,0,4,12,1,i,[27,3],1,0]),symbol:m([4,10,11,15,51,52,n,[54,6,1],1,3,i,[14,4],i,[13,7],5,14,19,10,10,18,20,n,[26,6,1],33,34,60,61,6,20,4,12,16,17,6,n,[36,13,1],20,28,i,[34,12],i,[12,12],34,n,[21,5,1],i,[94,12],5,18,i,[14,12],i,[56,24],i,[12,132],32,32,n,[35,14,1],20,28,29,62,63,i,[81,60],i,[249,3],13,i,[344,8],i,[24,12],16,i,[368,5],n,[53,7,1],6,i,[117,14],i,[15,150],31,31,35,49,i,[515,14],i,[14,70],5,7,8,9,14,19,i,[361,3],63,12,6,6,i,[315,15],i,[564,9],i,[12,12],i,[63,14],i,[353,12],i,[708,11],i,[639,13],7,14,19,i,[367,13],i,[115,6],6]),type:m([n,[2,4],n,[0,8],1,n,[2,5],n,[0,7],n,[2,15],i,[17,17],n,[2,17],i,[34,12],i,[12,14],i,[81,12],i,[14,14],i,[56,30],i,[12,130],i,[81,76],i,[249,24],i,[274,18],n,[2,252],i,[263,14],i,[278,6],i,[290,12],i,[302,27],i,[38,18],i,[49,20],i,[16,16]]),state:m([2,3,4,n,[6,5,1],15,16,i,[7,5],22,32,56,32,57,32,64,i,[21,7],67,i,[8,7],68,32,69,32,70,32,71,32,72,32,73,32,74,32,75,32,76,32,77,32,78,32,79,32,80,32,84,85,89,32,90,32,91,32,92,32,93,32,i,[67,7],95,32,15,98,i,[10,6],112,116,32,117,i,[66,7],118,i,[103,14],i,[7,7],122,i,[22,8],125,i,[16,6]]),mode:m([n,[1,301],n,[2,4],i,[6,6],n,[2,9],i,[15,13],i,[36,5],i,[45,10],i,[6,10],i,[15,11],i,[16,7],i,[15,9],i,[60,13],i,[15,68],n,[1,161]]),goto:m([5,n,[11,4,1],i,[5,4],n,[17,5,1],33,28,n,[23,5,1],29,30,31,34,35,37,36,n,[38,16,1],55,54,i,[32,10],i,[10,10],n,[58,6,1],i,[67,4],65,66,i,[6,4],i,[36,20],i,[10,110],81,82,83,i,[184,13],88,86,87,i,[69,50],i,[203,3],94,i,[204,11],96,97,i,[219,3],n,[37,4],43,44,n,[37,9],n,[38,4],43,44,n,[38,9],n,[41,3],i,[118,3],41,i,[118,8],42,42,i,[15,4],42,42,i,[15,7],43,43,i,[15,4],n,[43,3],i,[15,6],44,44,i,[15,4],n,[44,9],45,45,i,[178,5],n,[45,8],46,46,i,[15,4],n,[46,9],47,47,i,[15,4],n,[47,9],48,48,i,[15,4],n,[48,9],49,49,i,[15,4],n,[49,9],n,[99,5,1],i,[256,13],104,i,[14,13],105,i,[14,13],106,i,[14,13],107,i,[14,13],108,i,[14,13],17,109,110,111,18,19,i,[332,3],113,114,115,i,[295,13],13,i,[4,4],119,i,[44,13],i,[18,3],120,13,121,i,[27,7],17,123,18,19,124,i,[8,3],126,17,127,i,[66,4],128])}),defaultActions:o({idx:m([3,4,n,[6,6,1],14,15,16,n,[23,6,1],32,34,38,56,70,71,83,n,[85,4,1],94,96,n,[98,4,1],n,[103,5,1],112,114,120,125,126,128]),goto:m([4,5,n,[11,6,1],1,2,3,n,[27,6,1],50,19,20,35,39,40,36,n,[53,4,1],17,21,7,33,34,51,n,[22,5,1],52,6,18,10,8,9])}),parseError:function(u,h,t){if(h.recoverable)typeof this.trace=="function"&&this.trace(u),h.destroy();else throw typeof this.trace=="function"&&this.trace(u),t||(t=this.JisonParserError),new t(u,h)},parse:function(u){var h=this,t=new Array(128),s=new Array(128),g=new Array(128),a=new Array(128),l=this.table,x=0,G,w=0,W=this.TERROR,Z=this.EOF,Y=this.options.errorRecoveryTokenDiscardCount|0||3,Fe=[0,129],N;this.__lexer__?N=this.__lexer__:N=this.__lexer__=Object.create(this.lexer);var _={parseError:void 0,quoteName:void 0,lexer:void 0,parser:void 0,pre_parse:void 0,post_parse:void 0,pre_lex:void 0,post_lex:void 0},de;typeof assert!="function"?de=function(p,T){if(!p)throw new Error("assertion failed: "+(T||"***"))}:de=assert,this.yyGetSharedState=function(){return _};function H(f){if(typeof f=="object"){var p={};for(var T in f)Object.prototype.hasOwnProperty.call(f,T)&&(p[T]=f[T]);return p}return f}function te(f,p){for(var T in p)typeof f[T]=="undefined"&&Object.prototype.hasOwnProperty.call(p,T)&&(f[T]=p[T])}function ce(f){var p=H(f);return p&&p.range&&(p.range=p.range.slice(0)),p}te(_,this.yy),_.lexer=N,_.parser=this,typeof _.parseError=="function"?this.parseError=function(p,T,C){return C||(C=this.JisonParserError),_.parseError.call(this,p,T,C)}:this.parseError=this.originalParseError,typeof _.quoteName=="function"?this.quoteName=function(p){return _.quoteName.call(this,p)}:this.quoteName=this.originalQuoteName,this.cleanupAfterParse=function(p,T,C){var q;if(T){var S;(_.post_parse||this.post_parse)&&(S=this.constructParseErrorInfo(null,null,null,!1)),_.post_parse&&(q=_.post_parse.call(this,_,p,S),typeof q!="undefined"&&(p=q)),this.post_parse&&(q=this.post_parse.call(this,_,p,S),typeof q!="undefined"&&(p=q)),S&&S.destroy&&S.destroy()}if(this.__reentrant_call_depth>1)return p;if(N.cleanupAfterLex&&N.cleanupAfterLex(C),_&&(_.lexer=void 0,_.parser=void 0,N.yy===_&&(N.yy=void 0)),_=void 0,this.parseError=this.originalParseError,this.quoteName=this.originalQuoteName,t.length=0,s.length=0,a.length=0,g.length=0,x=0,!C){for(var D=this.__error_infos.length-1;D>=0;D--){var V=this.__error_infos[D];V&&typeof V.destroy=="function"&&V.destroy()}this.__error_infos.length=0}return p},this.yyMergeLocationInfo=function(p,T,C,q,S){var D=p|0,V=T|0,O=C,b=q,E;if(!O&&p!=null)for(var M=D;M<=V&&(O=a[M],!O);M++);if(!b&&T!=null)for(var M=V;M>=D&&(b=a[M],!b);M--);if(!O&&p==null){if(!S)for(var M=(D||x)-1;M>=0&&(O=a[M],!O);M--);return O?(E=H(O),E.first_line=E.last_line,E.first_column=E.last_column,E.range&&(E.range=E.range.slice(0),E.range[0]=E.range[1]),b&&(te(E,b),E.last_line=b.last_line,E.last_column=b.last_column,E.range&&b.range&&(E.range[1]=b.range[1])),E):b?(E=H(b),E.range&&(E.range=E.range.slice(0)),E):void 0}if(O||(O=b,b=null),!!O)return E=H(O),E.range&&(E.range=E.range.slice(0)),b&&(te(E,b),E.last_line=b.last_line,E.last_column=b.last_column,E.range&&b.range&&(E.range[1]=b.range[1])),E},this.constructParseErrorInfo=function(p,T,C,q){var S={errStr:p,exception:T,text:N.match,value:N.yytext,token:this.describeSymbol(w)||w,token_id:w,line:N.yylineno,loc:ce(N.yylloc),expected:C,recoverable:q,state:P,action:U,new_state:R,symbol_stack:t,state_stack:s,value_stack:g,location_stack:a,stack_pointer:x,yy:_,lexer:N,parser:this,destroy:function(){var V=!!this.recoverable;for(var O in this)this.hasOwnProperty(O)&&typeof O=="object"&&(this[O]=void 0);this.recoverable=V}};return this.__error_infos.push(S),S};function Ke(f){var p=h.getSymbolName(f);return p||(p=f),p}function Je(){var f=N.lex();return typeof f!="number"&&(f=h.symbols_[f]||f),f||Z}function fe(){var f=N.fastLex();return typeof f!="number"&&(f=h.symbols_[f]||f),f||Z}var pe=Je,P,U,v,ie,re={$:!0,_$:void 0,yy:_},I,xe,se,R,A=!1;try{if(this.__reentrant_call_depth++,N.setInput(u,_),typeof N.canIUse=="function"){var Ge=N.canIUse();Ge.fastLex&&typeof fe=="function"&&(pe=fe)}for(G=N.yylloc,a[x]=G,g[x]=null,s[x]=0,t[x]=0,++x,this.pre_parse&&this.pre_parse.call(this,_),_.pre_parse&&_.pre_parse.call(this,_),R=s[x-1];;){if(P=R,this.defaultActions[P])U=2,R=this.defaultActions[P];else if(w||(w=pe()),ie=l[P]&&l[P][w]||Fe,R=ie[1],U=ie[0],!U){var X,Ee=this.describeSymbol(w)||w,ne=this.collect_expected_token_set(P);typeof N.yylineno=="number"?X="Parse error on line "+(N.yylineno+1)+": ":X="Parse error: ",typeof N.showPosition=="function"&&(X+=`
`+N.showPosition(79-10,10)+`
`),ne.length?X+="Expecting "+ne.join(", ")+", got unexpected "+Ee:X+="Unexpected "+Ee,I=this.constructParseErrorInfo(X,null,ne,!1),v=this.parseError(I.errStr,I,this.JisonParserError),typeof v!="undefined"&&(A=v);break}switch(U){default:if(U instanceof Array){I=this.constructParseErrorInfo("Parse Error: multiple actions possible at state: "+P+", token: "+w,null,null,!1),v=this.parseError(I.errStr,I,this.JisonParserError),typeof v!="undefined"&&(A=v);break}I=this.constructParseErrorInfo("Parsing halted. No viable error recovery approach available due to internal system failure.",null,null,!1),v=this.parseError(I.errStr,I,this.JisonParserError),typeof v!="undefined"&&(A=v);break;case 1:t[x]=w,g[x]=N.yytext,a[x]=ce(N.yylloc),s[x]=R,++x,w=0,G=N.yylloc;continue;case 2:if(se=this.productions_[R-1],xe=se[1],v=this.performAction.call(re,G,R,x-1,g,a),typeof v!="undefined"){A=v;break}x-=xe;var me=se[0];t[x]=me,g[x]=re.$,a[x]=re._$,R=l[s[x-1]][me],s[x]=R,++x;continue;case 3:x!==-2&&(A=!0,x--,typeof g[x]!="undefined"&&(A=g[x]));break}break}}catch(f){if(f instanceof this.JisonParserError)throw f;if(N&&typeof N.JisonLexerError=="function"&&f instanceof N.JisonLexerError)throw f;I=this.constructParseErrorInfo("Parsing aborted due to exception.",f,null,!1),A=!1,v=this.parseError(I.errStr,I,this.JisonParserError),typeof v!="undefined"&&(A=v)}finally{A=this.cleanupAfterParse(A,!0,!0),this.__reentrant_call_depth--}return A}};J.originalParseError=J.parseError,J.originalQuoteName=J.quoteName;function ee(){this.yy={}}return ee.prototype=J,J.Parser=ee,new ee}()});var _e=B((tt,ge)=>{"use strict";var Ue={Whitespace:null,Indent:null,Dedent:null,EndOfLine:null,EndOfInput:null,UnaryMinus:null,Number:/-?[0-9]+(\.[0-9+])?/,String:/"([^"\\]*(?:\\.[^"\\]*)*)"/,BeginCommand:/<</,EndCommand:/>>/,Variable:/\$([A-Za-z0-9_.])+/,ShortcutOption:/->/,OptionStart:/\[\[/,OptionDelimit:/\|/,OptionEnd:/\]\]/,If:/if(?!\w)/,ElseIf:/elseif(?!\w)/,Else:/else(?!\w)/,EndIf:/endif(?!\w)/,Set:/set(?!\w)/,True:/true(?!\w)/,False:/false(?!\w)/,Null:/null(?!\w)/,LeftParen:/\(/,RightParen:/\)/,Comma:/,/,EqualTo:/(==|is(?!\w)|eq(?!\w))/,GreaterThan:/(>|gt(?!\w))/,GreaterThanOrEqualTo:/(>=|gte(?!\w))/,LessThan:/(<|lt(?!\w))/,LessThanOrEqualTo:/(<=|lte(?!\w))/,NotEqualTo:/(!=|neq(?!\w))/,Or:/(\|\||or(?!\w))/,And:/(&&|and(?!\w))/,Xor:/(\^|xor(?!\w))/,Not:/(!|not(?!\w))/,EqualToOrAssign:/(=|to(?!\w))/,Add:/\+/,Minus:/-/,Multiply:/\*/,Divide:/\//,AddAssign:/\+=/,MinusAssign:/-=/,MultiplyAssign:/\*=/,DivideAssign:/\/=/,Comment:"//",Identifier:/[a-zA-Z0-9_:.]+/,CommandCall:/([^>]|(?!>)[^>]+>)+(?=>>)/,Text:/.*/};ge.exports=Ue});var Le=B((it,Te)=>{"use strict";var Xe=_e(),be=class{constructor(){this.transitions=[],this.textRule=null,this.isTrackingNextIndentation=!1}addTransition(e,o,c){return this.transitions.push({token:e,regex:Xe[e],state:o||null,delimitsText:c||!1}),this}addTextRule(e,o){if(this.textRule)throw new Error("Cannot add more than one text rule to a state.");let c=[];this.transitions.forEach(i=>{i.delimitsText&&c.push(`(${i.regex.source})`)});let n=`((?!${c.join("|")}).)*`;return this.addTransition(e,o),this.textRule=this.transitions[this.transitions.length-1],this.textRule.regex=new RegExp(n),this}setTrackNextIndentation(e){return this.isTrackingNextIndentation=e,this}};Te.exports=be});var ve=B((rt,Oe)=>{"use strict";var k=Le();function ze(){return{base:new k().addTransition("BeginCommand","command",!0).addTransition("OptionStart","link",!0).addTransition("ShortcutOption","shortcutOption").addTextRule("Text"),shortcutOption:new k().setTrackNextIndentation(!0).addTransition("BeginCommand","expression",!0).addTextRule("Text","base"),command:new k().addTransition("If","expression").addTransition("Else").addTransition("ElseIf","expression").addTransition("EndIf").addTransition("Set","assignment").addTransition("EndCommand","base",!0).addTransition("CommandCall","commandOrExpression").addTextRule("Text"),commandOrExpression:new k().addTransition("EndCommand","base",!0).addTextRule("Text"),assignment:new k().addTransition("Variable").addTransition("EqualToOrAssign","expression").addTransition("AddAssign","expression").addTransition("MinusAssign","expression").addTransition("MultiplyAssign","expression").addTransition("DivideAssign","expression"),expression:new k().addTransition("EndCommand","base").addTransition("Number").addTransition("String").addTransition("LeftParen").addTransition("RightParen").addTransition("EqualTo").addTransition("EqualToOrAssign").addTransition("NotEqualTo").addTransition("GreaterThanOrEqualTo").addTransition("GreaterThan").addTransition("LessThanOrEqualTo").addTransition("LessThan").addTransition("Add").addTransition("Minus").addTransition("Multiply").addTransition("Divide").addTransition("And").addTransition("Or").addTransition("Xor").addTransition("Not").addTransition("Variable").addTransition("Comma").addTransition("True").addTransition("False").addTransition("Null").addTransition("Identifier").addTextRule(),link:new k().addTransition("OptionEnd","base",!0).addTransition("OptionDelimit","linkDestination",!0).addTextRule("Text"),linkDestination:new k().addTransition("Identifier").addTransition("OptionEnd","base")}}Oe.exports={makeStates:ze}});var $e=B((st,we)=>{"use strict";var Qe=ve(),Ie=class{constructor(){this.states=Qe.makeStates(),this.state="base",this.originalText="",this.lines=[],this.indentation=[[0,!1]],this.shouldTrackNextIndentation=!1,this.previousLevelOfIndentation=0,this.reset()}reset(){this.yytext="",this.yylloc={first_column:1,first_line:1,last_column:1,last_line:1},this.yylineno=1}lex(){if(this.isAtTheEndOfText()){this.yytext="";let e=this.indentation.pop();return e&&e[1]?"Dedent":"EndOfInput"}if(this.isAtTheEndOfLine()){if(!this.isAtTheEndOfText())return this.lexNextLine()}else return this.lexNextTokenOnCurrentLine();return"Invalid"}lexNextTokenOnCurrentLine(){let e=this.getCurrentLineIndentation();if(this.shouldTrackNextIndentation&&e>this.previousLevelOfIndentation)return this.indentation.push([e,!0]),this.shouldTrackNextIndentation=!1,this.yylloc.first_column=this.yylloc.last_column,this.yylloc.last_column+=e,this.yytext="","Indent";if(e<this.getLastRecordedIndentation()[0]){if(this.indentation.pop()[1])return this.yytext="",this.previousLevelOfIndentation=this.getLastRecordedIndentation()[0],"Dedent";this.lexNextTokenOnCurrentLine()}if(e===this.previousLevelOfIndentation&&this.yylloc.last_column===1&&(this.yylloc.last_column+=e),this.getCurrentLine().substring(this.yylloc.last_column-1).startsWith("//"))return this.lexNextLine();for(let o of this.getState().transitions){let c=this.getCurrentLine().substring(this.yylloc.last_column-1).match(o.regex);if(c===null||c.index!==0)continue;let n=c[0];this.yytext=this.getCurrentLine().substr(this.yylloc.last_column-1,n.length),o.token==="String"&&(this.yytext=this.yytext.substring(1,this.yytext.length-1).replace(/\\/g,"")),this.yylloc.first_column=this.yylloc.last_column,this.yylloc.last_column+=n.length,o.state&&(this.setState(o.state),this.shouldTrackNextIndentation&&this.getLastRecordedIndentation()[0]<e&&this.indentation.push([e,!1]));let i=this.getCurrentLine().substring(this.yylloc.last_column-1).match(/^\s*/);return i.length!==0&&(this.yylloc.last_column+=i[0].length),o.token}return"Invalid"}lexNextLine(){this.yylineno+=1;let e=this.getCurrentLine().replace(/\t/,"    ");return this.lines[this.yylineno-1]=e,this.previousLevelOfIndentation=this.getLastRecordedIndentation()[0],this.yytext="",this.yylloc={first_column:1,first_line:this.yylineno,last_column:1,last_line:this.yylineno},this.lex()}setState(e){if(this.states[e]===void 0)throw new Error(`Cannot set the unknown state [${e}]`);this.state=e,this.getState().isTrackingNextIndentation&&(this.shouldTrackNextIndentation=!0)}setInput(e){this.originalText=e.replace(/(\r\n)/g,`
`).replace(/\r/g,`
`).replace(/[\n\r]+$/,""),this.lines=this.originalText.split(`
`),this.reset()}getState(){return this.states[this.state]}getCurrentLine(){return this.lines[this.yylineno-1]}setCurrentLine(e){this.lines[this.yylineno-1]=e}getCurrentLineIndentation(){let e=this.getCurrentLine().match(/^(\s*)/g);return e===null&&e[0]===null?0:e[0].length}getLastRecordedIndentation(){return this.indentation.length===0?[0,!1]:this.indentation[this.indentation.length-1]}isAtTheEndOfText(){return this.isAtTheEndOfLine()&&this.yylloc.first_line>=this.lines.length}isAtTheEndOfLine(){return this.yylloc.last_column>=this.getCurrentLine().length}};we.exports=Ie});var Se=B((nt,Ae)=>{"use strict";var oe=class{},y=class{},ae=class{},le=class{},z=class{},F=class{},j=class{},L=class{},ue=class{};Ae.exports={types:{Text:oe,Shortcut:y,Jump:ae,Link:le,Conditional:z,Assignment:F,Literal:j,Expression:L,Command:ue},RootNode:class{constructor(r){this.name="RootNode",this.dialogNodes=r||[]}},DialogNode:class{constructor(r,e){this.type="DialogNode",this.name=e||null,this.content=r}},DialogOptionNode:class extends y{constructor(r,e,o){super();this.type="DialogOptionNode",this.text=r,this.content=e,this.lineNum=o?o.first_line:-1}},ConditionalDialogOptionNode:class extends y{constructor(r,e,o,c){super();this.type="ConditionalDialogOptionNode",this.text=r,this.content=e,this.conditionalExpression=o,this.lineNum=c?c.first_line:-1}},IfNode:class extends z{constructor(r,e){super();this.type="IfNode",this.expression=r,this.statement=e}},IfElseNode:class extends z{constructor(r,e,o){super();this.type="IfElseNode",this.expression=r,this.statement=e,this.elseStatement=o}},ElseNode:class extends z{constructor(r){super();this.type="ElseNode",this.statement=r}},ElseIfNode:class extends z{constructor(r,e,o){super();this.type="ElseIfNode",this.expression=r,this.statement=e,this.elseStatement=o}},TextNode:class extends oe{constructor(r,e){super();this.type="TextNode",this.text=r,this.lineNum=e?e.first_line:-1}},JumpNode:class extends ae{constructor(r,e){super();this.type="JumpNode",this.identifier=r,this.lineNum=e?e.first_line:-1,this.selectable=!0}},LinkNode:class extends le{constructor(r,e,o){super();this.type="LinkNode",this.text=r||null,this.identifier=e||this.text,this.lineNum=o?o.first_line:-1,this.selectable=!0}},NumericLiteralNode:class extends j{constructor(r){super();this.type="NumericLiteralNode",this.numericLiteral=r}},StringLiteralNode:class extends j{constructor(r){super();this.type="StringLiteralNode",this.stringLiteral=r}},BooleanLiteralNode:class extends j{constructor(r){super();this.type="BooleanLiteralNode",this.booleanLiteral=r}},NullLiteralNode:class extends j{constructor(r){super();this.type="NullLiteralNode",this.nullLiteral=r}},VariableNode:class extends j{constructor(r){super();this.type="VariableNode",this.variableName=r}},UnaryMinusExpressionNode:class extends L{constructor(r){super();this.type="UnaryMinusExpressionNode",this.expression=r}},ArithmeticExpressionNode:class extends L{constructor(r){super();this.type="ArithmeticExpressionNode",this.expression=r}},ArithmeticExpressionAddNode:class extends L{constructor(r,e){super();this.type="ArithmeticExpressionAddNode",this.expression1=r,this.expression2=e}},ArithmeticExpressionMinusNode:class extends L{constructor(r,e){super();this.type="ArithmeticExpressionMinusNode",this.expression1=r,this.expression2=e}},ArithmeticExpressionMultiplyNode:class extends L{constructor(r,e){super();this.type="ArithmeticExpressionMultiplyNode",this.expression1=r,this.expression2=e}},ArithmeticExpressionDivideNode:class{constructor(r,e){this.type="ArithmeticExpressionDivideNode",this.expression1=r,this.expression2=e}},BooleanExpressionNode:class extends L{constructor(r){super();this.type="BooleanExpressionNode",this.booleanExpression=r}},NegatedBooleanExpressionNode:class extends L{constructor(r){super();this.type="NegatedBooleanExpressionNode",this.booleanExpression=r}},BooleanOrExpressionNode:class extends L{constructor(r,e){super();this.type="BooleanOrExpressionNode",this.expression1=r,this.expression2=e}},BooleanAndExpressionNode:class extends L{constructor(r,e){super();this.type="BooleanAndExpressionNode",this.expression1=r,this.expression2=e}},BooleanXorExpressionNode:class extends L{constructor(r,e){super();this.type="BooleanXorExpressionNode",this.expression1=r,this.expression2=e}},EqualToExpressionNode:class extends L{constructor(r,e){super();this.type="EqualToExpressionNode",this.expression1=r,this.expression2=e}},NotEqualToExpressionNode:class extends L{constructor(r,e){super();this.type="EqualToExpressionNode",this.expression1=r,this.expression2=e}},GreaterThanExpressionNode:class extends L{constructor(r,e){super();this.type="GreaterThanExpressionNode",this.expression1=r,this.expression2=e}},GreaterThanOrEqualToExpressionNode:class extends L{constructor(r,e){super();this.type="GreaterThanOrEqualToExpressionNode",this.expression1=r,this.expression2=e}},LessThanExpressionNode:class extends L{constructor(r,e){super();this.type="LessThanExpressionNode",this.expression1=r,this.expression2=e}},LessThanOrEqualToExpressionNode:class extends L{constructor(r,e){super();this.type="LessThanOrEqualToExpressionNode",this.expression1=r,this.expression2=e}},SetVariableEqualToNode:class extends F{constructor(r,e){super();this.type="SetVariableEqualToNode",this.variableName=r,this.expression=e}},SetVariableAddNode:class extends F{constructor(r,e){super();this.type="SetVariableAddNode",this.variableName=r,this.expression=e}},SetVariableMinusNode:class extends F{constructor(r,e){super();this.type="SetVariableMinusNode",this.variableName=r,this.expression=e}},SetVariableMultipyNode:class extends F{constructor(r,e){super();this.type="SetVariableMultipyNode",this.variableName=r,this.expression=e}},SetVariableDivideNode:class extends F{constructor(r,e){super();this.type="SetVariableDivideNode",this.variableName=r,this.expression=e}},FunctionResultNode:class extends j{constructor(r,e){super();this.type="FunctionResultNode",this.functionName=r,this.args=e}},CommandNode:class extends ue{constructor(r,e){super();this.type="CommandNode",this.command=r,this.lineNum=e?e.first_line:-1}}}});var Pe=B((ot,Me)=>{"use strict";var K=class{},Re=class extends K{constructor(e,o,c){super();this.text=e,this.data=o,this.lineNum=c}},Ce=class extends K{constructor(e,o,c){super();this.text=e,this.data=o,this.lineNum=c}},qe=class extends K{constructor(e,o){super();this.options=e,this.lineNum=o,this.selected=-1}select(e){if(e<0||e>=this.options.length)throw new Error(`Cannot select option #${e}, there are only ${this.options.length} options`);this.selected=e}};Me.exports={Result:K,TextResult:Re,CommandResult:Ce,OptionsResult:qe}});var Be=B((at,De)=>{"use strict";var Ve=class{constructor(){this.data={}}set(e,o){this.data[e]=o}get(e){return this.data[e]}};De.exports=Ve});"use strict";var he=Ne().parser,We=$e(),ke=Se();he.lexer=new We;he.yy=ke;var Q=Pe(),Ze=Be(),$=ke.types,je=class{constructor(){this.yarnNodes={},this.variables=new Ze,this.functions={},this.visited={},this.registerFunction("visited",e=>!!this.visited[e[0]])}load(e){for(let o of e)this.yarnNodes[o.title]={title:o.title,tags:o.tags,body:o.body}}setVariableStorage(e){if(typeof e.set!="function"||typeof e.get!="function")throw new Error('Variable Storage object must contain both a "set" and "get" function');this.variables=e}registerFunction(e,o){if(typeof o!="function")throw new Error("Registered function must be...well...a function");this.functions[e]=o}*run(e){let o=this.yarnNodes[e];if(o===void 0)throw new Error(`Node "${e}" does not exist`);this.visited[e]=!0;let c=Array.from(he.parse(o.body)),n={title:o.title,tags:o.tags.split(" "),body:o.body};yield*this.evalNodes(c,n)}*evalNodes(e,o){if(!e)return;let c=null,n=null,i=null;for(let m of e)if(m instanceof $.Jump)n=m;else if(c!==null&&m instanceof i)c.push(m);else if(c!==null&&(yield*this.handleSelections(c),c=null,i=null),m instanceof $.Text)yield new Q.TextResult(m.text,o,m.lineNum);else if(m instanceof $.Link)i=$.Link,c=[m];else if(m instanceof $.Shortcut)i=$.Shortcut,c=[m];else if(m instanceof $.Assignment)this.evaluateAssignment(m);else if(m instanceof $.Conditional)yield*this.evalNodes(this.evaluateConditional(m),o);else if(m instanceof $.Command){if(m.command==="stop")return;yield new Q.CommandResult(m.command,o,m.lineNum)}n!==null?yield*this.run(n.identifier):c!==null&&(yield*this.handleSelections(c))}*handleSelections(e){if(e.length>0||e[0]instanceof $.Shortcut){let o=e.filter(n=>n.type==="ConditionalDialogOptionNode"?this.evaluateExpressionOrLiteral(n.conditionalExpression):!0);if(o.length===0)return;let c=new Q.OptionsResult(o.map(n=>n.text),o.map(n=>n.lineNum||-1));if(yield c,c.selected!==-1){let n=o[c.selected];n.content?yield*this.evalNodes(n.content):n.identifier&&(yield*this.run(n.identifier))}}else yield*this.run(e[0].identifier)}evaluateAssignment(e){let o=this.evaluateExpressionOrLiteral(e.expression),c=this.variables.get(e.variableName);if(e.type==="SetVariableAddNode")o+=c;else if(e.type==="SetVariableMinusNode")o-=c;else if(e.type==="SetVariableMultiplyNode")o*=c;else if(e.type==="SetVariableDivideNode")o/=c;else if(e.type!=="SetVariableEqualToNode")throw new Error(`I don't recognize assignment type ${e.type}`);this.variables.set(e.variableName,o)}evaluateConditional(e){if(e.type==="IfNode"){if(this.evaluateExpressionOrLiteral(e.expression))return e.statement}else if(e.type==="IfElseNode"||e.type==="ElseIfNode"){if(this.evaluateExpressionOrLiteral(e.expression))return e.statement;if(e.elseStatement)return this.evaluateConditional(e.elseStatement)}else if(e.type==="ElseNode")return e.statement;return null}evaluateExpressionOrLiteral(e){if(e instanceof $.Expression){if(e.type==="UnaryMinusExpressionNode")return-1*this.evaluateExpressionOrLiteral(e.expression);if(e.type==="ArithmeticExpressionNode")return this.evaluateExpressionOrLiteral(e.expression);if(e.type==="ArithmeticExpressionAddNode")return this.evaluateExpressionOrLiteral(e.expression1)+this.evaluateExpressionOrLiteral(e.expression2);if(e.type==="ArithmeticExpressionMinusNode")return this.evaluateExpressionOrLiteral(e.expression1)-this.evaluateExpressionOrLiteral(e.expression2);if(e.type==="ArithmeticExpressionMultiplyNode")return this.evaluateExpressionOrLiteral(e.expression1)*this.evaluateExpressionOrLiteral(e.expression2);if(e.type==="ArithmeticExpressionDivideNode")return this.evaluateExpressionOrLiteral(e.expression1)/this.evaluateExpressionOrLiteral(e.expression2);if(e.type==="BooleanExpressionNode")return this.evaluateExpressionOrLiteral(e.booleanExpression);if(e.type==="NegatedBooleanExpressionNode")return!this.evaluateExpressionOrLiteral(e.booleanExpression);if(e.type==="BooleanOrExpressionNode")return this.evaluateExpressionOrLiteral(e.expression1)||this.evaluateExpressionOrLiteral(e.expression2);if(e.type==="BooleanAndExpressionNode")return this.evaluateExpressionOrLiteral(e.expression1)&&this.evaluateExpressionOrLiteral(e.expression2);if(e.type==="BooleanXorExpressionNode")return!this.evaluateExpressionOrLiteral(e.expression1)!=!this.evaluateExpressionOrLiteral(e.expression2);if(e.type==="EqualToExpressionNode")return this.evaluateExpressionOrLiteral(e.expression1)===this.evaluateExpressionOrLiteral(e.expression2);if(e.type==="NotEqualToExpressionNode")return this.evaluateExpressionOrLiteral(e.expression1)!==this.evaluateExpressionOrLiteral(e.expression2);if(e.type==="GreaterThanExpressionNode")return this.evaluateExpressionOrLiteral(e.expression1)>this.evaluateExpressionOrLiteral(e.expression2);if(e.type==="GreaterThanOrEqualToExpressionNode")return this.evaluateExpressionOrLiteral(e.expression1)>=this.evaluateExpressionOrLiteral(e.expression2);if(e.type==="LessThanExpressionNode")return this.evaluateExpressionOrLiteral(e.expression1)<this.evaluateExpressionOrLiteral(e.expression2);if(e.type==="LessThenOrEqualToExpressionNode")return this.evaluateExpressionOrLiteral(e.expression1)<=this.evaluateExpressionOrLiteral(e.expression2);throw new Error(`I don't recognize expression type ${e.type}`)}else if(e instanceof $.Literal){if(e.type==="NumericLiteralNode")return parseFloat(e.numericLiteral);if(e.type==="StringLiteralNode")return e.stringLiteral;if(e.type==="BooleanLiteralNode")return e.booleanLiteral==="true";if(e.type==="NullLiteralNode")return null;if(e.type==="VariableNode")return this.variables.get(e.variableName);if(e.type==="FunctionResultNode"){if(this.functions[e.functionName])return this.functions[e.functionName](e.args.map(this.evaluateExpressionOrLiteral));throw new Error(`Function "${e.functionName}" not found`)}throw new Error(`I don't recognize literal type ${e.type}`)}else throw new Error(`I don't recognize expression/literal type ${e.type}`)}};module.exports={Runner:je,TextResult:Q.TextResult,CommandResult:Q.CommandResult,OptionsResult:Q.OptionsResult};
