(()=>{var F=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Re=F((X,ye)=>{var de=function(){var t=function($,Z,j,g){for(j=j||{},g=$.length;g--;j[$[g]]=Z);return j},e=[1,5],n=[1,11],r=[1,12],l=[1,13],o=[5,8,21,22,24,26],u=[1,17],ae=[1,18],oe=[1,19],h=[1,33],d=[1,28],p=[1,23],c=[1,24],x=[1,25],f=[1,26],E=[1,27],N=[1,29],m=[1,30],y=[1,31],O=[1,41],L=[1,42],T=[1,43],b=[1,44],U=[1,45],P=[1,46],D=[1,47],V=[1,48],S=[1,49],I=[1,50],_=[1,51],C=[1,52],q=[1,53],A=[11,46,47,48,49,50,51,52,53,54,55,56,57,58,59],ve=[1,88],we=[1,86],ke=[1,87],Ae=[11,46,47,48,51,52,53,54,55,56,57,58,59],Y=[11,46,51,52,53,54,55,56,57,58,59],ie=[46,62],Ve=[1,110],Se=[1,111],Ie={trace:function(){},yy:{},symbols_:{error:2,node:3,statements:4,EndOfInput:5,conditionalStatement:6,statement:7,BeginCommand:8,If:9,expression:10,EndCommand:11,EndIf:12,additionalConditionalStatements:13,Else:14,ElseIf:15,shortcut:16,command:17,jump:18,link:19,assignment:20,Text:21,ShortcutOption:22,Indent:23,Dedent:24,CommandCall:25,OptionStart:26,OptionEnd:27,OptionDelimit:28,Identifier:29,Set:30,Variable:31,EqualToOrAssign:32,AddAssign:33,MinusAssign:34,MultiplyAssign:35,DivideAssign:36,True:37,False:38,Number:39,String:40,Null:41,UnaryMinus:42,"%prec":43,Not:44,LeftParen:45,RightParen:46,Add:47,Minus:48,Multiply:49,Divide:50,Or:51,And:52,Xor:53,EqualTo:54,NotEqualTo:55,GreaterThan:56,GreaterThanOrEqualTo:57,LessThan:58,LessThanOrEqualTo:59,functionResultExpression:60,arguments:61,Comma:62,argument:63,$accept:0,$end:1},terminals_:{2:"error",5:"EndOfInput",8:"BeginCommand",9:"If",11:"EndCommand",12:"EndIf",14:"Else",15:"ElseIf",21:"Text",22:"ShortcutOption",23:"Indent",24:"Dedent",25:"CommandCall",26:"OptionStart",27:"OptionEnd",28:"OptionDelimit",29:"Identifier",30:"Set",31:"Variable",32:"EqualToOrAssign",33:"AddAssign",34:"MinusAssign",35:"MultiplyAssign",36:"DivideAssign",37:"True",38:"False",39:"Number",40:"String",41:"Null",42:"UnaryMinus",43:"%prec",44:"Not",45:"LeftParen",46:"RightParen",47:"Add",48:"Minus",49:"Multiply",50:"Divide",51:"Or",52:"And",53:"Xor",54:"EqualTo",55:"NotEqualTo",56:"GreaterThan",57:"GreaterThanOrEqualTo",58:"LessThan",59:"LessThanOrEqualTo",62:"Comma"},productions_:[0,[3,2],[4,2],[4,2],[4,1],[4,1],[6,8],[6,6],[13,7],[13,8],[13,6],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[16,5],[16,9],[17,3],[18,3],[19,5],[20,6],[20,6],[20,6],[20,6],[20,6],[10,1],[10,1],[10,1],[10,1],[10,1],[10,1],[10,4],[10,4],[10,2],[10,3],[10,3],[10,3],[10,3],[10,3],[10,3],[10,3],[10,3],[10,3],[10,3],[10,3],[10,3],[10,3],[10,3],[10,1],[60,4],[61,3],[61,1],[63,1],[63,1],[63,1]],performAction:function(Z,j,g,a,B,s,ne){var i=s.length-1;switch(B){case 1:return JSON.stringify(s[i-1],null,"  "),s[i-1];break;case 2:case 3:this.$=s[i-1].concat([s[i]]);break;case 4:case 5:case 53:this.$=[s[i]];break;case 6:this.$=new a.IfNode(s[i-5],s[i-3]);break;case 7:this.$=new a.IfElseNode(s[i-3],s[i-1],s[i]);break;case 8:this.$=new a.ElseNode(s[i-3]);break;case 9:this.$=new a.ElseIfNode(s[i-5],s[i-3]);break;case 10:this.$=new a.ElseIfNode(s[i-3],s[i-1],s[i]);break;case 11:case 12:case 13:case 14:case 15:case 50:this.$=s[i];break;case 16:this.$=new a.TextNode(s[i],this._$);break;case 17:this.$=new a.DialogOptionNode(s[i-3],s[i-1],this._$);break;case 18:this.$=new a.ConditionalDialogOptionNode(s[i-7],s[i-1],s[i-4],this._$);break;case 19:this.$=new a.CommandNode(s[i-1],this._$);break;case 20:this.$=new a.JumpNode(s[i-1],this._$);break;case 21:this.$=new a.LinkNode(s[i-3],s[i-1],this._$);break;case 22:this.$=new a.SetVariableEqualToNode(s[i-3].substring(1),s[i-1]);break;case 23:this.$=new a.SetVariableAddNode(s[i-3].substring(1),s[i-1]);break;case 24:this.$=new a.SetVariableMinusNode(s[i-3].substring(1),s[i-1]);break;case 25:this.$=new a.SetVariableMultipyNode(s[i-3].substring(1),s[i-1]);break;case 26:this.$=new a.SetVariableDivideNode(s[i-3].substring(1),s[i-1]);break;case 27:case 28:this.$=new a.BooleanLiteralNode(s[i]);break;case 29:case 54:this.$=new a.NumericLiteralNode(s[i]);break;case 30:case 55:this.$=new a.StringLiteralNode(s[i]);break;case 31:this.$=new a.NullLiteralNode(s[i]);break;case 32:case 56:this.$=new a.VariableNode(s[i].substring(1));break;case 33:this.$=new a.UnaryMinusExpressionNode(s[i-2]);break;case 34:this.$=new a.UnaryMinusExpressionNode(s[i-2].substring(1));break;case 35:this.$=new a.NegatedBooleanExpressionNode(s[i]);break;case 36:this.$=new a.ArithmeticExpressionNode(s[i-1]);break;case 37:this.$=new a.ArithmeticExpressionAddNode(s[i-2],s[i]);break;case 38:this.$=new a.ArithmeticExpressionMinusNode(s[i-2],s[i]);break;case 39:this.$=new a.ArithmeticExpressionMultiplyNode(s[i-2],s[i]);break;case 40:this.$=new a.ArithmeticExpressionDivideNode(s[i-2],s[i]);break;case 41:this.$=new a.BooleanOrExpressionNode(s[i-2],s[i]);break;case 42:this.$=new a.BooleanAndExpressionNode(s[i-2],s[i]);break;case 43:this.$=new a.BooleanXorExpressionNode(s[i-2],s[i]);break;case 44:this.$=new a.EqualToExpressionNode(s[i-2],s[i]);break;case 45:this.$=new a.NotEqualToExpressionNode(s[i-2],s[i]);break;case 46:this.$=new a.GreaterThanExpressionNode(s[i-2],s[i]);break;case 47:this.$=new a.GreaterThanOrEqualToExpressionNode(s[i-2],s[i]);break;case 48:this.$=new a.LessThanExpressionNode(s[i-2],s[i]);break;case 49:this.$=new a.LessThanOrEqualToExpressionNode(s[i-2],s[i]);break;case 51:this.$=new a.FunctionResultNode(s[i-3],s[i-1]);break;case 52:this.$=s[i-2].concat([s[i]]);break}},table:[{3:1,4:2,6:3,7:4,8:e,16:6,17:7,18:8,19:9,20:10,21:n,22:r,26:l},{1:[3]},{5:[1,14],6:15,7:16,8:e,16:6,17:7,18:8,19:9,20:10,21:n,22:r,26:l},t(o,[2,4]),t(o,[2,5]),{9:u,25:ae,30:oe},t(o,[2,11]),t(o,[2,12]),t(o,[2,13]),t(o,[2,14]),t(o,[2,15]),t(o,[2,16]),{21:[1,20]},{21:[1,21]},{1:[2,1]},t(o,[2,2]),t(o,[2,3]),{10:22,29:h,31:d,37:p,38:c,39:x,40:f,41:E,42:N,44:m,45:y,60:32},{11:[1,34]},{31:[1,35]},{8:[1,37],23:[1,36]},{27:[1,38],28:[1,39]},{11:[1,40],47:O,48:L,49:T,50:b,51:U,52:P,53:D,54:V,55:S,56:I,57:_,58:C,59:q},t(A,[2,27]),t(A,[2,28]),t(A,[2,29]),t(A,[2,30]),t(A,[2,31]),t(A,[2,32]),{31:[1,55],39:[1,54]},{10:56,29:h,31:d,37:p,38:c,39:x,40:f,41:E,42:N,44:m,45:y,60:32},{10:57,29:h,31:d,37:p,38:c,39:x,40:f,41:E,42:N,44:m,45:y,60:32},t(A,[2,50]),{45:[1,58]},t(o,[2,19]),{32:[1,59],33:[1,60],34:[1,61],35:[1,62],36:[1,63]},{4:64,6:3,7:4,8:e,16:6,17:7,18:8,19:9,20:10,21:n,22:r,26:l},{9:[1,65]},t(o,[2,20]),{29:[1,66]},{4:67,6:3,7:4,8:e,16:6,17:7,18:8,19:9,20:10,21:n,22:r,26:l},{10:68,29:h,31:d,37:p,38:c,39:x,40:f,41:E,42:N,44:m,45:y,60:32},{10:69,29:h,31:d,37:p,38:c,39:x,40:f,41:E,42:N,44:m,45:y,60:32},{10:70,29:h,31:d,37:p,38:c,39:x,40:f,41:E,42:N,44:m,45:y,60:32},{10:71,29:h,31:d,37:p,38:c,39:x,40:f,41:E,42:N,44:m,45:y,60:32},{10:72,29:h,31:d,37:p,38:c,39:x,40:f,41:E,42:N,44:m,45:y,60:32},{10:73,29:h,31:d,37:p,38:c,39:x,40:f,41:E,42:N,44:m,45:y,60:32},{10:74,29:h,31:d,37:p,38:c,39:x,40:f,41:E,42:N,44:m,45:y,60:32},{10:75,29:h,31:d,37:p,38:c,39:x,40:f,41:E,42:N,44:m,45:y,60:32},{10:76,29:h,31:d,37:p,38:c,39:x,40:f,41:E,42:N,44:m,45:y,60:32},{10:77,29:h,31:d,37:p,38:c,39:x,40:f,41:E,42:N,44:m,45:y,60:32},{10:78,29:h,31:d,37:p,38:c,39:x,40:f,41:E,42:N,44:m,45:y,60:32},{10:79,29:h,31:d,37:p,38:c,39:x,40:f,41:E,42:N,44:m,45:y,60:32},{10:80,29:h,31:d,37:p,38:c,39:x,40:f,41:E,42:N,44:m,45:y,60:32},{43:[1,81]},{43:[1,82]},t(A,[2,35]),{46:[1,83],47:O,48:L,49:T,50:b,51:U,52:P,53:D,54:V,55:S,56:I,57:_,58:C,59:q},{31:ve,39:we,40:ke,61:84,63:85},{10:89,29:h,31:d,37:p,38:c,39:x,40:f,41:E,42:N,44:m,45:y,60:32},{10:90,29:h,31:d,37:p,38:c,39:x,40:f,41:E,42:N,44:m,45:y,60:32},{10:91,29:h,31:d,37:p,38:c,39:x,40:f,41:E,42:N,44:m,45:y,60:32},{10:92,29:h,31:d,37:p,38:c,39:x,40:f,41:E,42:N,44:m,45:y,60:32},{10:93,29:h,31:d,37:p,38:c,39:x,40:f,41:E,42:N,44:m,45:y,60:32},{6:15,7:16,8:e,16:6,17:7,18:8,19:9,20:10,21:n,22:r,24:[1,94],26:l},{10:95,29:h,31:d,37:p,38:c,39:x,40:f,41:E,42:N,44:m,45:y,60:32},{27:[1,96]},{6:15,7:16,8:[1,97],13:98,16:6,17:7,18:8,19:9,20:10,21:n,22:r,26:l},t(Ae,[2,37],{49:T,50:b}),t(Ae,[2,38],{49:T,50:b}),t(A,[2,39]),t(A,[2,40]),t([11,46,51],[2,41],{47:O,48:L,49:T,50:b,52:P,53:D,54:V,55:S,56:I,57:_,58:C,59:q}),t([11,46,51,52],[2,42],{47:O,48:L,49:T,50:b,53:D,54:V,55:S,56:I,57:_,58:C,59:q}),t([11,46,51,52,53],[2,43],{47:O,48:L,49:T,50:b,54:V,55:S,56:I,57:_,58:C,59:q}),t(Y,[2,44],{47:O,48:L,49:T,50:b}),t(Y,[2,45],{47:O,48:L,49:T,50:b}),t(Y,[2,46],{47:O,48:L,49:T,50:b}),t(Y,[2,47],{47:O,48:L,49:T,50:b}),t(Y,[2,48],{47:O,48:L,49:T,50:b}),t(Y,[2,49],{47:O,48:L,49:T,50:b}),{42:[1,99]},{42:[1,100]},t(A,[2,36]),{46:[1,101],62:[1,102]},t(ie,[2,53]),t(ie,[2,54]),t(ie,[2,55]),t(ie,[2,56]),{11:[1,103],47:O,48:L,49:T,50:b,51:U,52:P,53:D,54:V,55:S,56:I,57:_,58:C,59:q},{11:[1,104],47:O,48:L,49:T,50:b,51:U,52:P,53:D,54:V,55:S,56:I,57:_,58:C,59:q},{11:[1,105],47:O,48:L,49:T,50:b,51:U,52:P,53:D,54:V,55:S,56:I,57:_,58:C,59:q},{11:[1,106],47:O,48:L,49:T,50:b,51:U,52:P,53:D,54:V,55:S,56:I,57:_,58:C,59:q},{11:[1,107],47:O,48:L,49:T,50:b,51:U,52:P,53:D,54:V,55:S,56:I,57:_,58:C,59:q},t(o,[2,17]),{11:[1,108],47:O,48:L,49:T,50:b,51:U,52:P,53:D,54:V,55:S,56:I,57:_,58:C,59:q},t(o,[2,21]),{9:u,12:[1,109],14:Ve,15:Se,25:ae,30:oe},t(o,[2,7]),t(A,[2,33]),t(A,[2,34]),t(A,[2,51]),{31:ve,39:we,40:ke,63:112},t(o,[2,22]),t(o,[2,23]),t(o,[2,24]),t(o,[2,25]),t(o,[2,26]),{23:[1,113]},{11:[1,114]},{11:[1,115]},{10:116,29:h,31:d,37:p,38:c,39:x,40:f,41:E,42:N,44:m,45:y,60:32},t(ie,[2,52]),{4:117,6:3,7:4,8:e,16:6,17:7,18:8,19:9,20:10,21:n,22:r,26:l},t(o,[2,6]),{4:118,6:3,7:4,8:e,16:6,17:7,18:8,19:9,20:10,21:n,22:r,26:l},{11:[1,119],47:O,48:L,49:T,50:b,51:U,52:P,53:D,54:V,55:S,56:I,57:_,58:C,59:q},{6:15,7:16,8:e,16:6,17:7,18:8,19:9,20:10,21:n,22:r,24:[1,120],26:l},{6:15,7:16,8:[1,121],16:6,17:7,18:8,19:9,20:10,21:n,22:r,26:l},{4:122,6:3,7:4,8:e,16:6,17:7,18:8,19:9,20:10,21:n,22:r,26:l},t(o,[2,18]),{9:u,12:[1,123],25:ae,30:oe},{6:15,7:16,8:[1,124],13:125,16:6,17:7,18:8,19:9,20:10,21:n,22:r,26:l},{11:[1,126]},{9:u,12:[1,127],14:Ve,15:Se,25:ae,30:oe},t(o,[2,10]),t(o,[2,8]),{11:[1,128]},t(o,[2,9])],defaultActions:{14:[2,1]},parseError:function(Z,j){if(j.recoverable)this.trace(Z);else{var g=new Error(Z);throw g.hash=j,g}},parse:function(Z){var j=this,g=[0],a=[],B=[null],s=[],ne=this.table,i="",le=0,_e=0,Ce=0,lt=2,qe=1,ut=s.slice.call(arguments,1),v=Object.create(this.lexer),H={yy:{}};for(var xe in this.yy)Object.prototype.hasOwnProperty.call(this.yy,xe)&&(H.yy[xe]=this.yy[xe]);v.setInput(Z,H.yy),H.yy.lexer=v,H.yy.parser=this,typeof v.yylloc=="undefined"&&(v.yylloc={});var fe=v.yylloc;s.push(fe);var ht=v.options&&v.options.ranges;typeof H.yy.parseError=="function"?this.parseError=H.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;function yt(G){g.length=g.length-2*G,B.length=B.length-G,s.length=s.length-G}e:var dt=function(){var G;return G=v.lex()||qe,typeof G!="number"&&(G=j.symbols_[G]||G),G};for(var k,Ee,K,M,gt,Ne,ee={},ue,z,Me,he;;){if(K=g[g.length-1],this.defaultActions[K]?M=this.defaultActions[K]:((k===null||typeof k=="undefined")&&(k=dt()),M=ne[K]&&ne[K][k]),typeof M=="undefined"||!M.length||!M[0]){var me="";he=[];for(ue in ne[K])this.terminals_[ue]&&ue>lt&&he.push("'"+this.terminals_[ue]+"'");v.showPosition?me="Parse error on line "+(le+1)+`:
`+v.showPosition()+`
Expecting `+he.join(", ")+", got '"+(this.terminals_[k]||k)+"'":me="Parse error on line "+(le+1)+": Unexpected "+(k==qe?"end of input":"'"+(this.terminals_[k]||k)+"'"),this.parseError(me,{text:v.match,token:this.terminals_[k]||k,line:v.yylineno,loc:fe,expected:he})}if(M[0]instanceof Array&&M.length>1)throw new Error("Parse Error: multiple actions possible at state: "+K+", token: "+k);switch(M[0]){case 1:g.push(k),B.push(v.yytext),s.push(v.yylloc),g.push(M[1]),k=null,Ee?(k=Ee,Ee=null):(_e=v.yyleng,i=v.yytext,le=v.yylineno,fe=v.yylloc,Ce>0&&Ce--);break;case 2:if(z=this.productions_[M[1]][1],ee.$=B[B.length-z],ee._$={first_line:s[s.length-(z||1)].first_line,last_line:s[s.length-1].last_line,first_column:s[s.length-(z||1)].first_column,last_column:s[s.length-1].last_column},ht&&(ee._$.range=[s[s.length-(z||1)].range[0],s[s.length-1].range[1]]),Ne=this.performAction.apply(ee,[i,_e,le,H.yy,M[1],B,s].concat(ut)),typeof Ne!="undefined")return Ne;z&&(g=g.slice(0,-1*z*2),B=B.slice(0,-1*z),s=s.slice(0,-1*z)),g.push(this.productions_[M[1]][0]),B.push(ee.$),s.push(ee._$),Me=ne[g[g.length-2]][g[g.length-1]],g.push(Me);break;case 3:return!0}}return!0}};function ce(){this.yy={}}return ce.prototype=Ie,Ie.Parser=ce,new ce}();typeof require!="undefined"&&typeof X!="undefined"&&(X.parser=de,X.Parser=de.Parser,X.parse=function(){return de.parse.apply(de,arguments)},X.main=function(e){e[1]||(console.log("Usage: "+e[0]+" FILE"),process.exit(1));var n=require("fs").readFileSync(require("path").normalize(e[1]),"utf8");return X.parser.parse(n)},typeof ye!="undefined"&&require.main===ye&&X.main(process.argv.slice(1)))});var Be=F((bt,De)=>{"use strict";var ge=class{},pe=class{},Te=class{},be=class{},te=class{},Q=class{},J=class{},w=class{},Oe=class{};De.exports={types:{Text:ge,Shortcut:pe,Jump:Te,Link:be,Conditional:te,Assignment:Q,Literal:J,Expression:w,Command:Oe},RootNode:class{constructor(t){this.name="RootNode",this.dialogNodes=t||[]}},DialogNode:class{constructor(t,e){this.type="DialogNode",this.name=e||null,this.content=t}},DialogOptionNode:class extends pe{constructor(t,e,n){super();this.type="DialogOptionNode",this.text=t,this.content=e,this.lineNum=n?n.first_line:-1}},ConditionalDialogOptionNode:class extends pe{constructor(t,e,n,r){super();this.type="ConditionalDialogOptionNode",this.text=t,this.content=e,this.conditionalExpression=n,this.lineNum=r?r.first_line:-1}},IfNode:class extends te{constructor(t,e){super();this.type="IfNode",this.expression=t,this.statement=e}},IfElseNode:class extends te{constructor(t,e,n){super();this.type="IfElseNode",this.expression=t,this.statement=e,this.elseStatement=n}},ElseNode:class extends te{constructor(t){super();this.type="ElseNode",this.statement=t}},ElseIfNode:class extends te{constructor(t,e,n){super();this.type="ElseIfNode",this.expression=t,this.statement=e,this.elseStatement=n}},TextNode:class extends ge{constructor(t,e){super();this.type="TextNode",this.text=t,this.lineNum=e?e.first_line:-1}},JumpNode:class extends Te{constructor(t,e){super();this.type="JumpNode",this.identifier=t,this.lineNum=e?e.first_line:-1,this.selectable=!0}},LinkNode:class extends be{constructor(t,e,n){super();this.type="LinkNode",this.text=t||null,this.identifier=e||this.text,this.lineNum=n?n.first_line:-1,this.selectable=!0}},NumericLiteralNode:class extends J{constructor(t){super();this.type="NumericLiteralNode",this.numericLiteral=t}},StringLiteralNode:class extends J{constructor(t){super();this.type="StringLiteralNode",this.stringLiteral=t}},BooleanLiteralNode:class extends J{constructor(t){super();this.type="BooleanLiteralNode",this.booleanLiteral=t}},NullLiteralNode:class extends J{constructor(t){super();this.type="NullLiteralNode",this.nullLiteral=t}},VariableNode:class extends J{constructor(t){super();this.type="VariableNode",this.variableName=t}},UnaryMinusExpressionNode:class extends w{constructor(t){super();this.type="UnaryMinusExpressionNode",this.expression=t}},ArithmeticExpressionNode:class extends w{constructor(t){super();this.type="ArithmeticExpressionNode",this.expression=t}},ArithmeticExpressionAddNode:class extends w{constructor(t,e){super();this.type="ArithmeticExpressionAddNode",this.expression1=t,this.expression2=e}},ArithmeticExpressionMinusNode:class extends w{constructor(t,e){super();this.type="ArithmeticExpressionMinusNode",this.expression1=t,this.expression2=e}},ArithmeticExpressionMultiplyNode:class extends w{constructor(t,e){super();this.type="ArithmeticExpressionMultiplyNode",this.expression1=t,this.expression2=e}},ArithmeticExpressionDivideNode:class{constructor(t,e){this.type="ArithmeticExpressionDivideNode",this.expression1=t,this.expression2=e}},BooleanExpressionNode:class extends w{constructor(t){super();this.type="BooleanExpressionNode",this.booleanExpression=t}},NegatedBooleanExpressionNode:class extends w{constructor(t){super();this.type="NegatedBooleanExpressionNode",this.booleanExpression=t}},BooleanOrExpressionNode:class extends w{constructor(t,e){super();this.type="BooleanOrExpressionNode",this.expression1=t,this.expression2=e}},BooleanAndExpressionNode:class extends w{constructor(t,e){super();this.type="BooleanAndExpressionNode",this.expression1=t,this.expression2=e}},BooleanXorExpressionNode:class extends w{constructor(t,e){super();this.type="BooleanXorExpressionNode",this.expression1=t,this.expression2=e}},EqualToExpressionNode:class extends w{constructor(t,e){super();this.type="EqualToExpressionNode",this.expression1=t,this.expression2=e}},NotEqualToExpressionNode:class extends w{constructor(t,e){super();this.type="EqualToExpressionNode",this.expression1=t,this.expression2=e}},GreaterThanExpressionNode:class extends w{constructor(t,e){super();this.type="GreaterThanExpressionNode",this.expression1=t,this.expression2=e}},GreaterThanOrEqualToExpressionNode:class extends w{constructor(t,e){super();this.type="GreaterThanOrEqualToExpressionNode",this.expression1=t,this.expression2=e}},LessThanExpressionNode:class extends w{constructor(t,e){super();this.type="LessThanExpressionNode",this.expression1=t,this.expression2=e}},LessThanOrEqualToExpressionNode:class extends w{constructor(t,e){super();this.type="LessThanOrEqualToExpressionNode",this.expression1=t,this.expression2=e}},SetVariableEqualToNode:class extends Q{constructor(t,e){super();this.type="SetVariableEqualToNode",this.variableName=t,this.expression=e}},SetVariableAddNode:class extends Q{constructor(t,e){super();this.type="SetVariableAddNode",this.variableName=t,this.expression=e}},SetVariableMinusNode:class extends Q{constructor(t,e){super();this.type="SetVariableMinusNode",this.variableName=t,this.expression=e}},SetVariableMultipyNode:class extends Q{constructor(t,e){super();this.type="SetVariableMultipyNode",this.variableName=t,this.expression=e}},SetVariableDivideNode:class extends Q{constructor(t,e){super();this.type="SetVariableDivideNode",this.variableName=t,this.expression=e}},FunctionResultNode:class extends J{constructor(t,e){super();this.type="FunctionResultNode",this.functionName=t,this.args=e}},CommandNode:class extends Oe{constructor(t,e){super();this.type="CommandNode",this.command=t,this.lineNum=e?e.first_line:-1}}}});var je=F((Ot,Pe)=>{"use strict";var pt={Whitespace:null,Indent:null,Dedent:null,EndOfLine:null,EndOfInput:null,UnaryMinus:null,Number:/-?[0-9]+(\.[0-9+])?/,String:/"([^"\\]*(?:\\.[^"\\]*)*)"/,BeginCommand:/<</,EndCommand:/>>/,Variable:/\$([A-Za-z0-9_.])+/,ShortcutOption:/->/,OptionStart:/\[\[/,OptionDelimit:/\|/,OptionEnd:/\]\]/,If:/if(?!\w)/,ElseIf:/elseif(?!\w)/,Else:/else(?!\w)/,EndIf:/endif(?!\w)/,Set:/set(?!\w)/,True:/true(?!\w)/,False:/false(?!\w)/,Null:/null(?!\w)/,LeftParen:/\(/,RightParen:/\)/,Comma:/,/,EqualTo:/(==|is(?!\w)|eq(?!\w))/,GreaterThan:/(>|gt(?!\w))/,GreaterThanOrEqualTo:/(>=|gte(?!\w))/,LessThan:/(<|lt(?!\w))/,LessThanOrEqualTo:/(<=|lte(?!\w))/,NotEqualTo:/(!=|neq(?!\w))/,Or:/(\|\||or(?!\w))/,And:/(&&|and(?!\w))/,Xor:/(\^|xor(?!\w))/,Not:/(!|not(?!\w))/,EqualToOrAssign:/(=|to(?!\w))/,Add:/\+/,Minus:/-/,Multiply:/\*/,Divide:/\//,AddAssign:/\+=/,MinusAssign:/-=/,MultiplyAssign:/\*=/,DivideAssign:/\/=/,Comment:"//",Identifier:/[a-zA-Z0-9_:.]+/,CommandCall:/([^>]|(?!>)[^>]+>)+(?=>>)/,Text:/.*/};Pe.exports=pt});var Ue=F((Lt,Ge)=>{"use strict";var ct=je(),Fe=class{constructor(){this.transitions=[],this.textRule=null,this.isTrackingNextIndentation=!1}addTransition(e,n,r){return this.transitions.push({token:e,regex:ct[e],state:n||null,delimitsText:r||!1}),this}addTextRule(e,n){if(this.textRule)throw new Error("Cannot add more than one text rule to a state.");let r=[];this.transitions.forEach(o=>{o.delimitsText&&r.push(`(${o.regex.source})`)});let l=`((?!${r.join("|")}).)*`;return this.addTransition(e,n),this.textRule=this.transitions[this.transitions.length-1],this.textRule.regex=new RegExp(l),this}setTrackNextIndentation(e){return this.isTrackingNextIndentation=e,this}};Ge.exports=Fe});var Xe=F((vt,ze)=>{"use strict";var W=Ue();function xt(){return{base:new W().addTransition("BeginCommand","command",!0).addTransition("OptionStart","link",!0).addTransition("ShortcutOption","shortcutOption").addTextRule("Text"),shortcutOption:new W().setTrackNextIndentation(!0).addTransition("BeginCommand","expression",!0).addTextRule("Text","base"),command:new W().addTransition("If","expression").addTransition("Else").addTransition("ElseIf","expression").addTransition("EndIf").addTransition("Set","assignment").addTransition("EndCommand","base",!0).addTransition("CommandCall","commandOrExpression").addTextRule("Text"),commandOrExpression:new W().addTransition("EndCommand","base",!0).addTextRule("Text"),assignment:new W().addTransition("Variable").addTransition("EqualToOrAssign","expression").addTransition("AddAssign","expression").addTransition("MinusAssign","expression").addTransition("MultiplyAssign","expression").addTransition("DivideAssign","expression"),expression:new W().addTransition("EndCommand","base").addTransition("Number").addTransition("String").addTransition("LeftParen").addTransition("RightParen").addTransition("EqualTo").addTransition("EqualToOrAssign").addTransition("NotEqualTo").addTransition("GreaterThanOrEqualTo").addTransition("GreaterThan").addTransition("LessThanOrEqualTo").addTransition("LessThan").addTransition("Add").addTransition("Minus").addTransition("Multiply").addTransition("Divide").addTransition("And").addTransition("Or").addTransition("Xor").addTransition("Not").addTransition("Variable").addTransition("Comma").addTransition("True").addTransition("False").addTransition("Null").addTransition("Identifier").addTextRule(),link:new W().addTransition("OptionEnd","base",!0).addTransition("OptionDelimit","linkDestination",!0).addTextRule("Text"),linkDestination:new W().addTransition("Identifier").addTransition("OptionEnd","base")}}ze.exports={makeStates:xt}});var Ze=F((wt,Je)=>{"use strict";var ft=Xe(),We=class{constructor(){this.states=ft.makeStates(),this.state="base",this.originalText="",this.lines=[],this.indentation=[[0,!1]],this.shouldTrackNextIndentation=!1,this.previousLevelOfIndentation=0,this.reset()}reset(){this.yytext="",this.yylloc={first_column:1,first_line:1,last_column:1,last_line:1},this.yylineno=1}lex(){if(this.isAtTheEndOfText()){this.yytext="";let e=this.indentation.pop();return e&&e[1]?"Dedent":"EndOfInput"}if(this.isAtTheEndOfLine()){if(!this.isAtTheEndOfText())return this.lexNextLine()}else return this.lexNextTokenOnCurrentLine();return"Invalid"}lexNextTokenOnCurrentLine(){let e=this.getCurrentLineIndentation();if(this.shouldTrackNextIndentation&&e>this.previousLevelOfIndentation)return this.indentation.push([e,!0]),this.shouldTrackNextIndentation=!1,this.yylloc.first_column=this.yylloc.last_column,this.yylloc.last_column+=e,this.yytext="","Indent";if(e<this.getLastRecordedIndentation()[0]){if(this.indentation.pop()[1])return this.yytext="",this.previousLevelOfIndentation=this.getLastRecordedIndentation()[0],"Dedent";this.lexNextTokenOnCurrentLine()}if(e===this.previousLevelOfIndentation&&this.yylloc.last_column===1&&(this.yylloc.last_column+=e),this.getCurrentLine().substring(this.yylloc.last_column-1).startsWith("//"))return this.lexNextLine();for(let n of this.getState().transitions){let r=this.getCurrentLine().substring(this.yylloc.last_column-1).match(n.regex);if(r===null||r.index!==0)continue;let l=r[0];this.yytext=this.getCurrentLine().substr(this.yylloc.last_column-1,l.length),n.token==="String"&&(this.yytext=this.yytext.substring(1,this.yytext.length-1).replace(/\\/g,"")),this.yylloc.first_column=this.yylloc.last_column,this.yylloc.last_column+=l.length,n.state&&(this.setState(n.state),this.shouldTrackNextIndentation&&this.getLastRecordedIndentation()[0]<e&&this.indentation.push([e,!1]));let o=this.getCurrentLine().substring(this.yylloc.last_column-1).match(/^\s*/);return o.length!==0&&(this.yylloc.last_column+=o[0].length),n.token}return"Invalid"}lexNextLine(){this.yylineno+=1;let e=this.getCurrentLine().replace(/\t/,"    ");return this.lines[this.yylineno-1]=e,this.previousLevelOfIndentation=this.getLastRecordedIndentation()[0],this.yytext="",this.yylloc={first_column:1,first_line:this.yylineno,last_column:1,last_line:this.yylineno},this.lex()}setState(e){if(this.states[e]===void 0)throw new Error(`Cannot set the unknown state [${e}]`);this.state=e,this.getState().isTrackingNextIndentation&&(this.shouldTrackNextIndentation=!0)}setInput(e){this.originalText=e.replace(/(\r\n)/g,`
`).replace(/\r/g,`
`).replace(/[\n\r]+$/,""),this.lines=this.originalText.split(`
`),this.reset()}getState(){return this.states[this.state]}getCurrentLine(){return this.lines[this.yylineno-1]}setCurrentLine(e){this.lines[this.yylineno-1]=e}getCurrentLineIndentation(){let e=this.getCurrentLine().match(/^(\s*)/g);return e===null&&e[0]===null?0:e[0].length}getLastRecordedIndentation(){return this.indentation.length===0?[0,!1]:this.indentation[this.indentation.length-1]}isAtTheEndOfText(){return this.isAtTheEndOfLine()&&this.yylloc.first_line>=this.lines.length}isAtTheEndOfLine(){return this.yylloc.last_column>=this.getCurrentLine().length}};Je.exports=We});var $e=F((kt,He)=>{"use strict";var re=class{},Ke=class extends re{constructor(e,n,r){super();this.text=e,this.data=n,this.lineNum=r}},Qe=class extends re{constructor(e,n,r){super();this.text=e,this.data=n,this.lineNum=r}},Ye=class extends re{constructor(e,n){super();this.options=e,this.lineNum=n,this.selected=-1}select(e){if(e<0||e>=this.options.length)throw new Error(`Cannot select option #${e}, there are only ${this.options.length} options`);this.selected=e}};He.exports={Result:re,TextResult:Ke,CommandResult:Qe,OptionsResult:Ye}});var st=F((At,et)=>{"use strict";var tt=class{constructor(){this.data={}}set(e,n){this.data[e]=n}get(e){return this.data[e]}};et.exports=tt});var at=F((Vt,it)=>{"use strict";var Le=Re().parser,nt=Be(),Et=Ze();Le.lexer=new Et;Le.yy=nt;var se=$e(),Nt=st(),R=nt.types,rt=class{constructor(){this.yarnNodes={},this.variables=new Nt,this.functions={},this.visited={},this.registerFunction("visited",e=>!!this.visited[e[0]])}load(e){for(let n of e)this.yarnNodes[n.title]={title:n.title,tags:n.tags,body:n.body}}setVariableStorage(e){if(typeof e.set!="function"||typeof e.get!="function")throw new Error('Variable Storage object must contain both a "set" and "get" function');this.variables=e}registerFunction(e,n){if(typeof n!="function")throw new Error("Registered function must be...well...a function");this.functions[e]=n}*run(e){let n=this.yarnNodes[e];if(n===void 0)throw new Error(`Node "${e}" does not exist`);this.visited[e]=!0;let r=Array.from(Le.parse(n.body)),l={title:n.title,tags:n.tags.split(" "),body:n.body};yield*this.evalNodes(r,l)}*evalNodes(e,n){if(!e)return;let r=null,l=null,o=null;for(let u of e)if(u instanceof R.Jump)l=u;else if(r!==null&&u instanceof o)r.push(u);else if(r!==null&&(yield*this.handleSelections(r),r=null,o=null),u instanceof R.Text)yield new se.TextResult(u.text,n,u.lineNum);else if(u instanceof R.Link)o=R.Link,r=[u];else if(u instanceof R.Shortcut)o=R.Shortcut,r=[u];else if(u instanceof R.Assignment)this.evaluateAssignment(u);else if(u instanceof R.Conditional)yield*this.evalNodes(this.evaluateConditional(u),n);else if(u instanceof R.Command){if(u.command==="stop")return;yield new se.CommandResult(u.command,n,u.lineNum)}l!==null?yield*this.run(l.identifier):r!==null&&(yield*this.handleSelections(r))}*handleSelections(e){if(e.length>0||e[0]instanceof R.Shortcut){let n=e.filter(l=>l.type==="ConditionalDialogOptionNode"?this.evaluateExpressionOrLiteral(l.conditionalExpression):!0);if(n.length===0)return;let r=new se.OptionsResult(n.map(l=>l.text),n.map(l=>l.lineNum||-1));if(yield r,r.selected!==-1){let l=n[r.selected];l.content?yield*this.evalNodes(l.content):l.identifier&&(yield*this.run(l.identifier))}}else yield*this.run(e[0].identifier)}evaluateAssignment(e){let n=this.evaluateExpressionOrLiteral(e.expression),r=this.variables.get(e.variableName);if(e.type==="SetVariableAddNode")n+=r;else if(e.type==="SetVariableMinusNode")n-=r;else if(e.type==="SetVariableMultiplyNode")n*=r;else if(e.type==="SetVariableDivideNode")n/=r;else if(e.type!=="SetVariableEqualToNode")throw new Error(`I don't recognize assignment type ${e.type}`);this.variables.set(e.variableName,n)}evaluateConditional(e){if(e.type==="IfNode"){if(this.evaluateExpressionOrLiteral(e.expression))return e.statement}else if(e.type==="IfElseNode"||e.type==="ElseIfNode"){if(this.evaluateExpressionOrLiteral(e.expression))return e.statement;if(e.elseStatement)return this.evaluateConditional(e.elseStatement)}else if(e.type==="ElseNode")return e.statement;return null}evaluateExpressionOrLiteral(e){if(e instanceof R.Expression){if(e.type==="UnaryMinusExpressionNode")return-1*this.evaluateExpressionOrLiteral(e.expression);if(e.type==="ArithmeticExpressionNode")return this.evaluateExpressionOrLiteral(e.expression);if(e.type==="ArithmeticExpressionAddNode")return this.evaluateExpressionOrLiteral(e.expression1)+this.evaluateExpressionOrLiteral(e.expression2);if(e.type==="ArithmeticExpressionMinusNode")return this.evaluateExpressionOrLiteral(e.expression1)-this.evaluateExpressionOrLiteral(e.expression2);if(e.type==="ArithmeticExpressionMultiplyNode")return this.evaluateExpressionOrLiteral(e.expression1)*this.evaluateExpressionOrLiteral(e.expression2);if(e.type==="ArithmeticExpressionDivideNode")return this.evaluateExpressionOrLiteral(e.expression1)/this.evaluateExpressionOrLiteral(e.expression2);if(e.type==="BooleanExpressionNode")return this.evaluateExpressionOrLiteral(e.booleanExpression);if(e.type==="NegatedBooleanExpressionNode")return!this.evaluateExpressionOrLiteral(e.booleanExpression);if(e.type==="BooleanOrExpressionNode")return this.evaluateExpressionOrLiteral(e.expression1)||this.evaluateExpressionOrLiteral(e.expression2);if(e.type==="BooleanAndExpressionNode")return this.evaluateExpressionOrLiteral(e.expression1)&&this.evaluateExpressionOrLiteral(e.expression2);if(e.type==="BooleanXorExpressionNode")return!this.evaluateExpressionOrLiteral(e.expression1)!=!this.evaluateExpressionOrLiteral(e.expression2);if(e.type==="EqualToExpressionNode")return this.evaluateExpressionOrLiteral(e.expression1)===this.evaluateExpressionOrLiteral(e.expression2);if(e.type==="NotEqualToExpressionNode")return this.evaluateExpressionOrLiteral(e.expression1)!==this.evaluateExpressionOrLiteral(e.expression2);if(e.type==="GreaterThanExpressionNode")return this.evaluateExpressionOrLiteral(e.expression1)>this.evaluateExpressionOrLiteral(e.expression2);if(e.type==="GreaterThanOrEqualToExpressionNode")return this.evaluateExpressionOrLiteral(e.expression1)>=this.evaluateExpressionOrLiteral(e.expression2);if(e.type==="LessThanExpressionNode")return this.evaluateExpressionOrLiteral(e.expression1)<this.evaluateExpressionOrLiteral(e.expression2);if(e.type==="LessThenOrEqualToExpressionNode")return this.evaluateExpressionOrLiteral(e.expression1)<=this.evaluateExpressionOrLiteral(e.expression2);throw new Error(`I don't recognize expression type ${e.type}`)}else if(e instanceof R.Literal){if(e.type==="NumericLiteralNode")return parseFloat(e.numericLiteral);if(e.type==="StringLiteralNode")return e.stringLiteral;if(e.type==="BooleanLiteralNode")return e.booleanLiteral==="true";if(e.type==="NullLiteralNode")return null;if(e.type==="VariableNode")return this.variables.get(e.variableName);if(e.type==="FunctionResultNode"){if(this.functions[e.functionName])return this.functions[e.functionName](e.args.map(this.evaluateExpressionOrLiteral));throw new Error(`Function "${e.functionName}" not found`)}throw new Error(`I don't recognize literal type ${e.type}`)}else throw new Error(`I don't recognize expression/literal type ${e.type}`)}};it.exports={Runner:rt,TextResult:se.TextResult,CommandResult:se.CommandResult,OptionsResult:se.OptionsResult}});var mt=F((St,ot)=>{"use strict";ot.exports=at()});mt();})();
